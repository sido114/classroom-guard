#!/bin/bash
# Pre-commit hook for Classroom Guard
# Runs linting and type checking before allowing commits

set -e

echo "ğŸ” Running pre-commit checks..."

# Check if we're in the root directory
if [ ! -d "frontend" ] || [ ! -d "backend" ]; then
    echo "âŒ Error: Must run from project root"
    exit 1
fi

# Frontend checks
echo ""
echo "ğŸ“¦ Frontend checks..."
cd frontend

# Check if node_modules exists
if [ ! -d "node_modules" ]; then
    echo "âš ï¸  node_modules not found, skipping frontend checks"
else
    # Run ESLint
    echo "  â†’ Running ESLint..."
    npm run lint || {
        echo "âŒ ESLint failed! Fix errors before committing."
        exit 1
    }

    # Run TypeScript type check
    echo "  â†’ Running TypeScript check..."
    npx tsc --noEmit || {
        echo "âŒ TypeScript errors found! Fix errors before committing."
        exit 1
    }
fi

cd ..

# Backend checks
echo ""
echo "ğŸ”§ Backend checks..."
cd backend

# Check if mvnw exists
if [ ! -f "mvnw" ]; then
    echo "âš ï¸  mvnw not found, skipping backend checks"
else
    # Run backend tests
    echo "  â†’ Running backend tests..."
    ./mvnw test -q || {
        echo "âŒ Backend tests failed! Fix tests before committing."
        exit 1
    }
fi

cd ..

echo ""
echo "âœ… All pre-commit checks passed!"
exit 0
